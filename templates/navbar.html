{% load static %}

<!-- Premium Announcement Ticker -->
<div class="sprs-ticker" id="sprsTicker">
    <div class="ticker-track">
        <span>üè† Discover Verified Rental Properties</span>
        <span>‚ö° Fast. Reliable. Trusted.</span>
        <span>üìç Properties Across All 77 Districts of Nepal</span>
        <span>üí¨ Direct Chat with Property Owners</span>
        <span>ü§ñ AI-Powered Bilingual Search</span>
        <span>‚≠ê Nepal's Most Trusted Rental Platform</span>
        <span>üè† Discover Verified Rental Properties</span>
        <span>‚ö° Fast. Reliable. Trusted.</span>
        <span>üìç Properties Across All 77 Districts of Nepal</span>
        <span>üí¨ Direct Chat with Property Owners</span>
        <span>ü§ñ AI-Powered Bilingual Search</span>
        <span>‚≠ê Nepal's Most Trusted Rental Platform</span>
    </div>
</div>

<!-- Ultra-Premium Navigation -->
<nav class="sprs-navbar sticky-top" id="sprsNavbar">
    <div class="container-xl">
        <div class="d-flex align-items-center justify-content-between w-100">

            <!-- Brand -->
            <a class="sprs-brand" href="{% url 'home' %}">
                <div class="brand-icon"><i class="bi bi-building-fill"></i></div>
                <div class="brand-text">
                    <span class="brand-name">SPRS</span>
                    <span class="brand-tagline">Smart Rentals</span>
                </div>
            </a>

            <!-- Desktop Nav -->
            <ul class="sprs-nav-links d-none d-lg-flex">
                <li>
                    <a href="{% url 'properties:list' %}" class="sprs-nav-link">
                        <i class="bi bi-houses"></i><span>Properties</span>
                    </a>
                </li>
                <li>
                    <a href="{% url 'properties:map_explorer' %}" class="sprs-nav-link">
                        <i class="bi bi-map"></i><span>Map Explorer</span>
                    </a>
                </li>
                <li>
                    <a href="{% url 'properties:compare' %}" class="sprs-nav-link position-relative">
                        <i class="bi bi-stack"></i><span>Compare</span>
                        {% if request.session.compare_properties %}
                        <span class="sprs-badge">{{ request.session.compare_properties|length }}</span>
                        {% endif %}
                    </a>
                </li>
                {% if user.is_authenticated %}
                <li>
                    <a href="{% url 'dashboard:index' %}" class="sprs-nav-link">
                        <i class="bi bi-speedometer2"></i><span>Dashboard</span>
                    </a>
                </li>
                <li>
                    <a href="{% url 'messaging:inbox' %}" class="sprs-nav-link position-relative">
                        <i class="bi bi-envelope"></i><span>Messages</span>
                        {% if unread_messages_count %}
                        <span class="sprs-badge">{{ unread_messages_count }}</span>
                        {% endif %}
                    </a>
                </li>
                <li>
                    <a href="{% url 'notifications:list' %}" class="sprs-nav-link position-relative">
                        <i class="bi bi-bell"></i>
                        {% if unread_notification_count %}
                        <span class="sprs-badge notify">{{ unread_notification_count }}</span>
                        {% endif %}
                    </a>
                </li>
                <li>
                    <a href="{% url 'favorites:list' %}" class="sprs-nav-link">
                        <i class="bi bi-heart"></i><span>Favorites</span>
                    </a>
                </li>
                {% if user.is_owner %}
                <li>
                    <a href="{% url 'properties:create' %}" class="sprs-nav-link">
                        <i class="bi bi-plus-circle"></i><span>Add Property</span>
                    </a>
                </li>
                {% endif %}
                {% if user.role == 'admin' or user.is_superuser %}
                <li>
                    <a href="{% url 'adminpanel:dashboard' %}" class="sprs-nav-link">
                        <i class="bi bi-gear"></i><span>Admin</span>
                    </a>
                </li>
                {% endif %}
                {% endif %}
            </ul>

            <!-- Right Actions -->
            <div class="sprs-nav-actions d-none d-lg-flex">
                <button class="sprs-icon-btn" onclick="toggleDarkMode()" title="Toggle theme">
                    <i class="bi bi-moon-fill theme-toggle-icon"></i>
                </button>

                {% if user.is_authenticated %}
                <div class="dropdown">
                    <button class="sprs-user-btn dropdown-toggle" data-bs-toggle="dropdown">
                        {% if user.profile_picture %}
                        <img src="{{ user.profile_picture.url }}" alt="" class="user-avatar-img">
                        {% else %}
                        <div class="user-avatar-placeholder"><i class="bi bi-person-fill"></i></div>
                        {% endif %}
                        <span>{{ user.get_full_name|default:user.username }}</span>
                        <i class="bi bi-chevron-down" style="font-size:.7rem;opacity:.6;"></i>
                    </button>
                    <ul class="sprs-dropdown dropdown-menu dropdown-menu-end">
                        <li class="sprs-dropdown-header">
                            <span>{{ user.username }}</span>
                            <span class="role-badge">{{ user.get_role_display }}</span>
                        </li>
                        <li><a class="dropdown-item" href="{% url 'users:profile' %}"><i class="bi bi-person"></i> My Profile</a></li>
                        <li><a class="dropdown-item" href="{% url 'dashboard:index' %}"><i class="bi bi-speedometer2"></i> Dashboard</a></li>
                        <li><a class="dropdown-item" href="{% url 'favorites:list' %}"><i class="bi bi-heart"></i> Favorites</a></li>
                        {% if user.is_owner %}
                        <li><a class="dropdown-item" href="{% url 'properties:manage_requests' %}"><i class="bi bi-inbox"></i> Property Requests</a></li>
                        {% endif %}
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item text-danger" href="{% url 'users:logout' %}"><i class="bi bi-box-arrow-right"></i> Logout</a></li>
                    </ul>
                </div>
                {% else %}
                <a href="{% url 'users:login' %}" class="sprs-btn-ghost">Sign In</a>
                <a href="{% url 'users:register' %}" class="sprs-btn-primary">Get Started</a>
                {% endif %}
            </div>

            <!-- Mobile Toggle -->
            <button class="sprs-hamburger d-lg-none" data-bs-toggle="collapse" data-bs-target="#mobileNav">
                <span></span><span></span><span></span>
            </button>
        </div>

        <!-- Mobile Nav -->
        <div class="collapse" id="mobileNav">
            <div class="sprs-mobile-menu">
                <a href="{% url 'properties:list' %}" class="mobile-link"><i class="bi bi-houses"></i> Properties</a>
                <a href="{% url 'properties:map_explorer' %}" class="mobile-link"><i class="bi bi-map"></i> Map Explorer</a>
                <a href="{% url 'properties:compare' %}" class="mobile-link"><i class="bi bi-stack"></i> Compare</a>
                {% if user.is_authenticated %}
                <a href="{% url 'dashboard:index' %}" class="mobile-link"><i class="bi bi-speedometer2"></i> Dashboard</a>
                <a href="{% url 'messaging:inbox' %}" class="mobile-link"><i class="bi bi-envelope"></i> Messages</a>
                <a href="{% url 'favorites:list' %}" class="mobile-link"><i class="bi bi-heart"></i> Favorites</a>
                {% if user.is_owner %}<a href="{% url 'properties:create' %}" class="mobile-link"><i class="bi bi-plus-circle"></i> Add Property</a>{% endif %}
                <a href="{% url 'users:logout' %}" class="mobile-link text-danger"><i class="bi bi-box-arrow-right"></i> Logout</a>
                {% else %}
                <a href="{% url 'users:login' %}" class="mobile-link"><i class="bi bi-box-arrow-in-right"></i> Sign In</a>
                <a href="{% url 'users:register' %}" class="mobile-link accent"><i class="bi bi-person-plus"></i> Get Started</a>
                {% endif %}
            </div>
        </div>
    </div>
</nav>

    <div class="container">
        <a class="navbar-brand fw-bold d-flex align-items-center" href="{% url 'home' %}">
            <i class="bi bi-building me-2"></i>
            <span>SPRS</span>
        </a>

        <button class="navbar-toggler" type="button"
                data-bs-toggle="collapse" data-bs-target="#navbarMain"
                aria-controls="navbarMain" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarMain">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'properties:list' %}">
                        <i class="bi bi-houses me-1"></i>Properties
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'properties:map_explorer' %}">
                        <i class="bi bi-map me-1"></i>Map Explorer
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link position-relative" href="{% url 'properties:compare' %}">
                        <i class="bi bi-stack me-1"></i>Compare
                        {% if request.session.compare_properties %}
                        <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-primary">
                            {{ request.session.compare_properties|length }}
                        </span>
                        {% endif %}
                    </a>
                </li>

                {% if user.is_authenticated %}
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'dashboard:index' %}">
                        <i class="bi bi-speedometer2 me-1"></i>Dashboard
                    </a>
                </li>

                <li class="nav-item">
                    <a class="nav-link position-relative" href="{% url 'messaging:inbox' %}">
                        <i class="bi bi-envelope me-1"></i>Messages
                        {% if unread_messages_count %}
                        <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                            {{ unread_messages_count }}
                        </span>
                        {% endif %}
                    </a>
                </li>

                <li class="nav-item">
                    <a class="nav-link position-relative" href="{% url 'notifications:list' %}">
                        <i class="bi bi-bell me-1"></i>
                        {% if unread_notification_count %}
                        <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-warning text-dark">
                            {{ unread_notification_count }}
                        </span>
                        {% endif %}
                    </a>
                </li>

                <li class="nav-item">
                    <a class="nav-link" href="{% url 'favorites:list' %}">
                        <i class="bi bi-heart me-1"></i>Favorites
                    </a>
                </li>

                {% if user.is_owner %}
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'properties:create' %}">
                        <i class="bi bi-plus-circle me-1"></i>Add Property
                    </a>
                </li>
                {% endif %}

                {% if user.role == 'admin' or user.is_superuser %}
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'adminpanel:dashboard' %}">
                        <i class="bi bi-gear me-1"></i>Admin Panel
                    </a>
                </li>
                {% endif %}
                {% endif %}
            </ul>

            <ul class="navbar-nav ms-auto mb-2 mb-lg-0 align-items-center">
                <!-- Dark Mode Toggle -->
                <li class="nav-item me-2">
                    <button class="btn btn-link nav-link" onclick="toggleDarkMode()" title="Toggle Dark Mode">
                        <i class="bi bi-moon-fill theme-toggle-icon"></i>
                    </button>
                </li>
                
                {% if user.is_authenticated %}
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle d-flex align-items-center" href="#"
                       id="userDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        {% if user.profile_picture %}
                        <img src="{{ user.profile_picture.url }}" alt="{{ user.username }}"
                             class="rounded-circle me-2" width="28" height="28"
                             style="object-fit: cover;">
                        {% else %}
                        <i class="bi bi-person-circle me-2" style="font-size: 1.25rem;"></i>
                        {% endif %}
                        {{ user.get_full_name|default:user.username }}
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end shadow" aria-labelledby="userDropdown">
                        <li>
                            <span class="dropdown-item-text text-muted small">
                                Signed in as <strong>{{ user.username }}</strong>
                                <br>
                                <span class="badge bg-secondary">{{ user.get_role_display }}</span>
                            </span>
                        </li>
                        <li><hr class="dropdown-divider"></li>
                        <li>
                            <a class="dropdown-item" href="{% url 'users:profile' %}">
                                <i class="bi bi-person me-2"></i>My Profile
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item" href="{% url 'dashboard:index' %}">
                                <i class="bi bi-speedometer2 me-2"></i>Dashboard
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item" href="{% url 'favorites:list' %}">
                                <i class="bi bi-heart me-2"></i>My Favorites
                            </a>
                        </li>
                        {% if user.is_owner %}
                        <li>
                            <a class="dropdown-item" href="{% url 'properties:manage_requests' %}">
                                <i class="bi bi-inbox me-2"></i>Property Requests
                            </a>
                        </li>
                        {% endif %}
                        <li><hr class="dropdown-divider"></li>
                        <li>
                            <a class="dropdown-item text-danger" href="{% url 'users:logout' %}">
                                <i class="bi bi-box-arrow-right me-2"></i>Logout
                            </a>
                        </li>
                    </ul>
                </li>
                {% else %}
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'users:login' %}">
                        <i class="bi bi-box-arrow-in-right me-1"></i>Login
                    </a>
                </li>
                <li class="nav-item">
                    <a class="btn btn-outline-light btn-sm ms-2 mt-1" href="{% url 'users:register' %}">
                        <i class="bi bi-person-plus me-1"></i>Register
                    </a>
                </li>
                {% endif %}
            </ul>
        </div>
    </div>
</nav>
